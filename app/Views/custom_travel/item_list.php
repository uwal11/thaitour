<?php $this->extend('inc/layout_index'); ?>
<?php $this->section('content'); ?>
<link rel="stylesheet" href="/css/travel/sub_travel.css" type="text/css">
<link rel="stylesheet" href="/css/travel/sub_travel_responsive.css" type="text/css">

<main>
    <section class="main_visual travel">
        <div class="inner">
            <div class="top">
                <h3>우리에게 딱 맞춰서 프라이빗하게!</h3>
                <p class="ttl"><span>호주</span> 단독 가이드 <br class="only_web">
                    맞춤여행</p>

            </div>
        </div>
    </section>

    <section class="prepare_sect flex__c">
        <div class="inner">
            <p class="top_ttl">
                호주여행,<br class="only_mo"> <span>어떻게 준비해야 할지</span> <br class="only_web">
                고민이라면?
                <img src="https://hihojoo.com/assets/img/sub/pre_img.png" alt="">
            </p>
        </div>
    </section>

    <section class="planing_sect">
        <div class="inner">
            <p class="top_ttl">여행 계획, 어렵고 막막하시죠? <br>
                이런 생각 하시는 분들<br class="only_mo"> 많을거예요!
            </p>
            <div class="plan_card only_web">
                <div class="plan_slider">
                    <div class="slide_box">
                        <div class="box">
                            <div class="txt">
                                친구들끼리 다같이 여행가기로 햇는데
                                우리끼리만요! 도움이 좀 필요해요!!
                            </div>
                            <div class="profile flex flex__c">
                                <img src="https://hihojoo.com/assets/img/sub/profile_img01.png" alt="" class="only_web">
                                <img src="https://hihojoo.com/assets/img/sub/profile_img01_mo.png" alt="" class="only_mo">
                                <span>신무전동기들모여라</span>
                            </div>
                        </div>
                    </div>
                    <div class="slide_box">
                        <div class="box">
                            <div class="txt">
                                나이 드신 어머니가 좀 몸이 불편하신
                                데요. 같이 편히 여행하고 싶은데...
                            </div>
                            <div class="profile flex flex__c">
                                <img src="https://hihojoo.com/assets/img/sub/profile_img02.png" alt="" class="only_web">
                                <img src="https://hihojoo.com/assets/img/sub/profile_img02_mo.png" alt="" class="only_mo">
                                <span>여행찾아삼만리</span>
                            </div>
                        </div>
                    </div>
                    <div class="slide_box">
                        <div class="box">
                            <div class="txt">
                                처음으로 호주로 출장을 다녀오게 되었
                                는데, 심지어 우리 팀을 다 끌고 가야되요
                            </div>
                            <div class="profile flex flex__c">
                                <img src="https://hihojoo.com/assets/img/sub/profile_img03.png" alt="" class="only_web">
                                <img src="https://hihojoo.com/assets/img/sub/profile_img03_mo.png" alt="" class="only_mo">
                                <span>새회사의서러움</span>
                            </div>
                        </div>
                    </div>
                    <div class="slide_box">
                        <div class="box">
                            <div class="txt">
                                우리 가족을 위한 여행을 하고 싶어요. 우리 아이는 소중하니까요.
                            </div>
                            <div class="profile flex flex__c">
                                <img src="https://hihojoo.com/assets/img/sub/profile_4.png" alt="" class="only_web">
                                <img src="https://hihojoo.com/assets/img/sub/profile_4_mb.png" alt="" class="only_mo">
                                <span>닭다리휴먼전</span>
                            </div>
                        </div>
                    </div>
                    <div class="slide_box">
                        <div class="box">
                            <div class="txt">
                                출장중에 여유롭게 관광 및 운동도 하고 싶어요.
                            </div>
                            <div class="profile flex flex__c">
                                <img src="https://hihojoo.com/assets/img/sub/profile_5.png" alt="" class="only_web">
                                <img src="https://hihojoo.com/assets/img/sub/profile_5_mb.png" alt="" class="only_mo">
                                <span>모서리휴지</span>
                            </div>
                        </div>
                    </div>
                    <div class="slide_box">
                        <div class="box">
                            <div class="txt">
                                여행도 하며 맛집도 다녀보고 우리가 선호하는 나를 위한 여행을 하고 싶은데
                            </div>
                            <div class="profile flex flex__c">
                                <img src="https://hihojoo.com/assets/img/sub/profile_6.png" alt="" class="only_web">
                                <img src="https://hihojoo.com/assets/img/sub/profile_6_mb.png" alt="" class="only_mo">
                                <span>여행행복사람</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="slider_btn">
                    <ul class="plan-dots"></ul>
                </div>
            </div>
            <div class="plan_card_mo only_mo">
                <div class="plan_slider_mo">
                    <div class="slide_box">
                        <div class="box">
                            <div class="txt">
                                친구들끼리 다같이 여행가기로 햇는데
                                우리끼리만요! 도움이 좀 필요해요!!
                            </div>
                            <div class="profile flex flex__c">
                                <img src="https://hihojoo.com/assets/img/sub/profile_img01.png" alt="" class="only_web">
                                <img src="https://hihojoo.com/assets/img/sub/profile_img01_mo.png" alt="" class="only_mo">
                                <span>신무전동기들모여라</span>
                            </div>
                        </div>
                    </div>
                    <div class="slide_box">
                        <div class="box">
                            <div class="txt">
                                나이 드신 어머니가 좀 몸이 불편하신
                                데요. 같이 편히 여행하고 싶은데...
                            </div>
                            <div class="profile flex flex__c">
                                <img src="https://hihojoo.com/assets/img/sub/profile_img02.png" alt="" class="only_web">
                                <img src="https://hihojoo.com/assets/img/sub/profile_img02_mo.png" alt="" class="only_mo">
                                <span>여행찾아삼만리</span>
                            </div>
                        </div>
                    </div>
                    <div class="slide_box">
                        <div class="box">
                            <div class="txt">
                                처음으로 호주로 출장을 다녀오게 되었
                                는데, 심지어 우리 팀을 다 끌고 가야되요
                            </div>
                            <div class="profile flex flex__c">
                                <img src="https://hihojoo.com/assets/img/sub/profile_img03.png" alt="" class="only_web">
                                <img src="https://hihojoo.com/assets/img/sub/profile_img03_mo.png" alt="" class="only_mo">
                                <span>새회사의서러움</span>
                            </div>
                        </div>
                    </div>
                    <div class="slide_box">
                        <div class="box">
                            <div class="txt">
                                우리 가족을 위한 여행을 하고 싶어요. 우리 아이는 소중하니까요.
                            </div>
                            <div class="profile flex flex__c">
                                <img src="https://hihojoo.com/assets/img/sub/profile_4.png" alt="" class="only_web">
                                <img src="https://hihojoo.com/assets/img/sub/profile_4_mb.png" alt="" class="only_mo">
                                <span>닭다리휴먼전</span>
                            </div>
                        </div>
                    </div>
                    <div class="slide_box">
                        <div class="box">
                            <div class="txt">
                                출장중에 여유롭게 관광 및 운동도 하고 싶어요.
                            </div>
                            <div class="profile flex flex__c">
                                <img src="https://hihojoo.com/assets/img/sub/profile_5.png" alt="" class="only_web">
                                <img src="https://hihojoo.com/assets/img/sub/profile_5_mb.png" alt="" class="only_mo">
                                <span>모서리휴지</span>
                            </div>
                        </div>
                    </div>
                    <div class="slide_box">
                        <div class="box">
                            <div class="txt">
                                여행도 하며 맛집도 다녀보고 우리가 선호하는 나를 위한 여행을 하고 싶은데
                            </div>
                            <div class="profile flex flex__c">
                                <img src="https://hihojoo.com/assets/img/sub/profile_6.png" alt="" class="only_web">
                                <img src="https://hihojoo.com/assets/img/sub/profile_6_mb.png" alt="" class="only_mo">
                                <span>여행행복사람</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="slider_btn">
                    <ul class="plans-dots"></ul>
                </div>
            </div>
        </div>
    </section>
    <script>
        $(function () {
            $('.plan_slider').slick({
                autoplay: true,
                arrows: true,
                dots: true,
                appendDots: $('.plan-dots'),
                slidesToScroll: 3,
                slidesToShow: 3,
            });
        })
        $(function () {
            $('.plan_slider_mo').slick({
                autoplay: true,
                arrows: true,
                dots: true,
                appendDots: $('.plans-dots'),
                slidesToScroll: 1,
                slidesToShow: 1,
                rows: 3,
            });
        });
    </script>
    <section class="satisfy_sect">
        <img src="https://hihojoo.com/assets/img/sub/satisfy_img.png" alt="" class="only_web">
        <img src="https://hihojoo.com/assets/img/sub/satisfy_img_mo.png" alt="" class="only_mo">
    </section>
    <div id="section1"></div>
    <section class="travel_info">
        <div class="inner">
            <div class="sect_ttl_box" id="bs_table">
                <h2>맞춤여행견적요청</h2>
                <div class="common_tab_wrap flex_b_c">
                    <ul class="common_tab flex_c_c">
                    </ul>
                    <form name="search" id="search">
                        <div class="evaluate_search flex">
                            <select name="search_mode" class="evaluate_filter_selection">
                                <!-- <option value="title" <?php if ($search_mode == "title")
                                    echo "selected"; ?>>제목</option>
                                <option value="contents" <?php if ($search_mode == "contents")
                                    echo "selected"; ?>>내용</option> -->
                                <option value="user_name" <?php if ($search_mode == "user_name")
                                    echo "selected"; ?>>글쓴이
                                </option>
                            </select>
                            <input type="text" name="s_txt" value="<?= $s_txt ?>">
                            <button class="search_button" type="button" onclick="search_it()">검색</button>
                        </div>
                    </form>
                </div>
            </div>

            <table class="bs_table">
                <colgroup>
                    <col width="80px">
                    <col width="*">
                    <col width="140px">
                    <col width="140px">
                    <col width="110px">
                </colgroup>
                <thead>
                    <tr>
                        <th>NO</th>
                        <th>여행 인원</th>
                        <th>작성자(KO)</th>
                        <th>작성자(ENG)</th>
                        <th>등록일</th>
                    </tr>
                </thead>
                <tbody>
                    <?php


                    $now = strtotime(date("Y-m-d H:i:s"));
                    if ($total_cnt == 0) {
                        ?>
                        <tr>
                            <td colspan=5 style="text-align:center;height:100px">검색된 결과가 없습니다.</td>
                        </tr>
                        <?php
                    }
                    foreach ($result as $row) {
                        $time = strtotime($row['r_date']);
                        $diff_time = $now - $time;
                        $is_new = $diff_time < (24 * 60 * 60) ? "<i></i>" : "";
                        if (
                            ($_SESSION['member']['idx'] && $row["user_id"] == $_SESSION['member']['idx'])
                            || ($_SESSION['member']['idx'] && $_SESSION['member']['level'] <= 2)
                        ) {
                            $is_secure = false;
                            $href = "/mypage/custom_travel_view.php?idx=" . $row['idx'];
                        } else if ($row['m_idx'] && $row['m_idx'] != $_SESSION['member']['idx']) {
                            $is_secure = true;
                            $href = "javascript:alert('내가쓴글만 열람이 가능합니다.')";
                        } else {
                            $is_secure = true;
                            $href = "/mypage/custom_travel_view.php?idx=" . $row['idx'];
                        }

                        ?>
                        <tr>
                            <td class="num"><span><?= $no ?></span></td>
                            <td class="subject_travel">
                                <a href="<?= $href ?>" class="subject" style="gap: 3px;">
                                    <span>성인: <?= $row['travel_person1'] ? $row['travel_person1'] : "0" ?>명</span> /
                                    <span>어린이: <?= $row['travel_person2'] ? $row['travel_person2'] : "0" ?>명</span> /
                                    <span>유아: <?= $row['travel_person3'] ? $row['travel_person3'] : "0" ?>명</span>
                                    <?= ($is_secure ? "<i></i>" : "") ?>
                                </a>
                            </td>
                            <td class="name"><?= strAsterisk(sqlSecretConver($row["user_name_kor"], 'decode')) ?></td>
                            <td class="name name_en"><?= strAsterisk(sqlSecretConver($row["user_name_eng"], 'decode')) ?>
                            </td>
                            <td class="date date_travel"><?= date("Y.m.d", strtotime($row['r_date'])) ?></td>
                        </tr>
                        <?php $no--;
                    } ?>
                </tbody>
            </table>
            <div class="paging_wrap">
                <?php echo ipageListing2($page, $total_page, $total_cnt, $currentUri . "?search_mode=" . $search_mode . "&s_txt=" . $s_txt . "&page=", $deviceType, 'bs_table') ?>
                <a href="./item_write.php" class="btn btn-point btn-lg contact_btn">글쓰기</a>
            </div>
        </div>
    </section>
</main>

<script>
    // function search_it() {
    //     var frm = document.search;
    //     frm.submit();
    // }
    function search_it() {
        // Lấy giá trị từ các trường form
        var searchMode = document.querySelector('select[name="search_mode"]').value;
        var searchText = document.querySelector('input[name="s_txt"]').value;

        // Tạo URL với query string và thêm hash
        var newUrl = window.location.pathname + "?search_mode=" + encodeURIComponent(searchMode) + "&s_txt=" + encodeURIComponent(searchText) + "#section1";
        console.log(newUrl);
        // Chuyển hướng trình duyệt đến URL mới mà không tạo ra bản ghi trong lịch sử
        window.location.replace(newUrl);
    }
    // Lấy phần tử input và placeholder
    var input = document.getElementById('captcha_input');
    var placeholder = document.querySelector('.placeholder-text');

    // Kiểm tra sự thay đổi của input
    input.addEventListener('input', function () {
        if (input.value) {
            // Nếu input có giá trị, ẩn placeholder
            placeholder.classList.add('hide-placeholder');
        } else {
            // Nếu input trống, hiển thị placeholder
            placeholder.classList.remove('hide-placeholder');
        }
    });

    // Kiểm tra ngay khi tải trang trong trường hợp người dùng điền và làm mới trang
    if (input.value) {
        placeholder.classList.add('hide-placeholder');
    }
</script>
<script>

    document.getElementById('cap_re').style.opacity = "0"
    function reloadCaptcha() {
        $.ajax({
            url: '/tools/generate_captcha',
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                document.getElementById('cap_re').src = data.captcha_image;
                document.getElementById('hidden_captcha').value = data.captcha_value;
                document.getElementById('spinner_load').style.display = "none"
                document.getElementById('cap_re').style.opacity = "1"
            }
        })
    }

    reloadCaptcha(); // Gọi hàm ngay sau khi được khai báo
</script>

<script type="text/javascript">


    const currentYear = (new Date()).getFullYear();
    const datePickerConfig = {
        closeText: '닫기',
        prevText: '이전달',
        nextText: '다음달',
        currentText: '오늘',
        monthNames: ['1월(JAN)', '2월(FEB)', '3월(MAR)', '4월(APR)', '5월(MAY)', '6월(JUN)',
            '7월(JUL)', '8월(AUG)', '9월(SEP)', '10월(OCT)', '11월(NOV)', '12월(DEC)'],
        monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월',
            '7월', '8월', '9월', '10월', '11월', '12월'],
        dayNames: ['일', '월', '화', '수', '목', '금', '토'],
        dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
        dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
        weekHeader: 'Wk',
        dateFormat: 'yy-mm-dd',
        firstDay: 0,
        isRTL: false,
        showMonthAfterYear: true,
        showButtonPanel: true,
        showOn: 'button',
        buttonImageOnly: true,
        buttonImage: '/assets/img/main/icon_datepic.png',
        changeMonth: true,
        changeYear: true,
        yearRange: "1900:" + currentYear,
        yearSuffix: ''
    }

    $('.tick_ch input[type="radio"]').on('change', function () {
        var idx = $(this).parent().index();
        $('.ticket .tic_form').removeClass('on');
        $('.ticket .tic_form').eq(idx).addClass('on');
    })



    function limitInput(input, max) {
        input.value = input.value.replace(/[^0-9]/g, '');
        if (input.value.length > max) {
            input.value = input.value.slice(0, max);
        }
    }

    function removePerson(element, length) {
        $(element).parent('.title').remove();
        $('.traveler' + length).remove();
    }

    function handleAddCompanion(event) {
        var total_per = 0;

        let per1 = Number($('#travel_person1').val());
        let per2 = Number($('#travel_person2').val());
        let per3 = Number($('#travel_person3').val());
        total_per = per1 + per2 + per3;
        // console.log(total_per);
        event.preventDefault();
        event.stopPropagation();

        const elements = $("#name_per_travel").find(".traveler");
        if (total_per != 0) {

            if (elements.length <= 0) {
                console.log(elements.length);
                const tableElement = `
                    <p class="title">
                        동반여행자  01
                        <i onclick="removePerson(this, 1)">삭제</i>
                    </p>
                    <table class="table_form traveler traveler1">
                        <colgroup>
                            <col width="125px" />
                            <col width="*" />
                        </colgroup>
                        <tbody>
                            <tr>
                                <th>여행자 성함*</th>
                                <td>
                                    <div class="name_user flex">
                                        <input type="text" class="bs-input" name="user_name_kor_accom[]" class="user_name_kor_accom" placeholder="한글이름">
                                        <input type="text" class="bs-input" name="user_name_eng_accom[]" class="user_name_eng_accom" placeholder="영문이름">
                                    </div>
                                    <div class="noti_red">
                                        ※ 영문명은 반드시 여권과 동일해야 합니다
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>생년월일</th>
                                <td>
                                    <div class="departure_date">
                                        <div class="flex__c"><input type="text" class="bs-input date_pic_y_chg" name="birthday_accom[]" placeholder="0000-00-00"
                                                 readonly></div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                `

                var scriptTag = document.createElement('script');

                scriptTag.innerHTML = `
                setTimeout(() => {
                    $("#datepicker1").datepicker(datePickerConfig).datepicker('widget').wrap('<div class="ll-skin-melon"/>');
                }, 0);
                `;

                $('#name_per_travel').html(tableElement);

                const clonedElement = $("#name_per_travel").find(".traveler");
                clonedElement.find(".ui-datepicker-trigger").remove();
                clonedElement.find(".date_pic_y_chg").removeClass("hasDatepicker");

                clonedElement.find(".date_pic_y_chg").attr("id", `datepicker1`);

                clonedElement.after($(scriptTag));
            }
            else {
                console.log(elements.length);
                if (elements.length < total_per) {
                    const element = elements.last();
                    const clonedElement = element.clone();
                    clonedElement.removeClass();
                    clonedElement.addClass("traveler table_form");
                    clonedElement.addClass(`traveler${elements.length + 1}`);
                    clonedElement.find(".ui-datepicker-trigger").remove();
                    clonedElement.find("input.user_name_kor_accom").val('');
                    clonedElement.find("input.user_name_eng_accom").val('');
                    clonedElement.find("input.date_pic_y_chg").val('');
                    clonedElement.find(".date_pic_y_chg").removeClass("hasDatepicker");
                    clonedElement.find(".date_pic_y_chg").attr("id", `datepicker${elements.length + 1}`);

                    var scriptTag = document.createElement('script');

                    scriptTag.innerHTML = `
                    setTimeout(() => {
                        $("#datepicker${elements.length + 1}").datepicker(datePickerConfig).datepicker('widget').wrap('<div class="ll-skin-melon"/>');
                    }, 0);
                    `;

                    element.after($(scriptTag));

                    element.after(clonedElement);
                    element.after(`
                        <p class="title" id="title${elements.length + 1}">
                            동반여행자  0${elements.length + 1}
                            <i onclick="removePerson(this, ${elements.length + 1})">삭제</i>
                        </p>
                    `);

                }
            }
        } else {
            alert("작성해주세요 여행 인원");
        }
    }



    document.getElementById("btn_add_compa").addEventListener("click", handleAddCompanion);
    $("#btn_submit_inquiry").on("click", function () {

        var total_per = 0;

        let per1 = Number($('#travel_person1').val());
        let per2 = Number($('#travel_person2').val());
        let per3 = Number($('#travel_person3').val());

        var captchaValue = $("#hidden_captcha").val();
        var userInputCaptcha = $("#captcha_input").val();
        total_per = per1 + per2 + per3;

        console.log(captchaValue, 'captchaValue')
        console.log(userInputCaptcha, 'userInputCaptcha')


        if ($("#travel_person1").val() == "" || Number($("#travel_person1").val()) == 0) {
            alert("이름을 입력해 해주세요.");
            $("#travel_person1").focus();
            return false;
        }


        if ($("#user_name_kor").val() == "") {
            alert("이름을 입력해 해주세요.");
            $("#user_name_kor").focus();
            return false;
        }

        if ($("#phone_1").val() == "") {
            alert("연락처를 입력해 해주세요.");
            $("#phone_1").focus();
            return false;
        }

        if ($("#phone_2").val() == "") {
            alert("연락처를 입력해 해주세요.");
            $("#phone_2").focus();
            return false;
        }

        if ($("#phone_3").val() == "") {
            alert("연락처를 입력해 해주세요.");
            $("#phone_3").focus();
            return false;
        }

        $("#user_phone").val($("#phone_1").val() + '-' + $("#phone_2").val() + '-' + $("#phone_3").val());

        if ($("#user_email1").val() == "") {
            alert("연락처를 입력해 해주세요.");
            $("#user_email1").focus();
            return false;
        }

        if ($("#user_email_2").val() == "") {
            alert("연락처를 입력해 해주세요.");
            $("#user_email_2").focus();
            return false;
        }

        if ($("#user_email1").val() && $("#user_email_2").val()) {
            $("#user_email").val($("#user_email1").val() + '@' + $("#user_email_2").val());
        }

        let user_name_kor_accom_missing = 0;

        for (let index = 1; index <= total_per; index++) {
            if ($(`.traveler${index}`).length > 0) {
                if ($(`.traveler${index} input.user_name_kor_accom`).val() == "") {
                    user_name_kor_accom_missing = index;
                    break;
                }
            }
        }

        if (user_name_kor_accom_missing) {
            alert("이름을 입력해 해주세요.");
            $(`.traveler${user_name_kor_accom_missing} input.user_name_kor_accom`).focus();
            return false;
        }
        if (userInputCaptcha !== captchaValue) {
            alert("보안문자 일치지않습니다.");
            $("#captcha_input").focus();
            reloadCaptcha();
            return false;
        }


        let selectedCheckboxes = [];

        $.each($("input[name='visit_route']:checked"), function () {
            selectedCheckboxes.push($(this).val());
        });

        $("input[name='visit_routes']").val(selectedCheckboxes.join(", "))

        $.ajax({
            url: "./inquiry_ok.php",
            type: "POST",
            data: $("#reg_mem_fm").serialize(),
            success: () => {
                alert("견적요청 신청되었습니다.");
                location.href = "../main/main.php"
            }
        })
    })
    $(document).ready(function () {
        $('.date_pic_y_chg').datepicker(datePickerConfig)
            .datepicker('widget').wrap('<div class="ll-skin-melon"/>');

    });


</script>
<?php $this->endSection(); ?>